<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Request a Quote - Jefrey Jurado</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/responsive.css">
  <link rel="stylesheet" href="styles/platform-unified.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Open Sans', Arial, sans-serif;
      background: linear-gradient(135deg, #1C4D8C, #000);
      min-height: 100vh;
      color: #fff;
      display: flex;
      flex-direction: column;
    }
    
    nav {
      background: rgba(52, 113, 204, 0.3);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .nav-left a {
      color: #50c2f7;
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: bold;
    }
    
    .nav-right a {
      color: #02f7ff;
      text-decoration: none;
      margin-left: 1rem;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      font-weight: bold;
    }
    
    main {
      flex: 1;
      padding: 3rem 2rem;
      max-width: 800px;
      margin: 0 auto;
      width: 100%;
    }
    
    .page-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .page-header h1 {
      color: #50c2f7;
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }
    
    .page-header p {
      color: #ddd;
      font-size: 1.1rem;
    }
    
    .user-status {
      background: rgba(80, 194, 247, 0.1);
      border: 1px solid rgba(80, 194, 247, 0.3);
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 2rem;
      text-align: center;
    }
    
    .user-status.logged-in {
      background: rgba(76, 175, 80, 0.1);
      border-color: rgba(76, 175, 80, 0.3);
    }
    
    .form-container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 3rem;
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: #fff;
      font-weight: 600;
    }
    
    .form-group label .required {
      color: #ff4444;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 1rem;
      border: 1px solid #3471cc;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.9);
      font-size: 1rem;
      font-family: 'Open Sans', Arial, sans-serif;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #50c2f7;
      box-shadow: 0 0 0 3px rgba(80, 194, 247, 0.2);
      background: white;
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 120px;
    }
    
    .service-info {
      background: rgba(80, 194, 247, 0.1);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      border: 1px solid rgba(80, 194, 247, 0.3);
    }
    
    .service-info h3 {
      color: #50c2f7;
      margin-bottom: 0.5rem;
      font-size: 1.2rem;
    }
    
    .service-info p {
      color: #ddd;
      margin: 0;
    }
    
    .btn-submit {
      width: 100%;
      padding: 1rem;
      background: #7e0101;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-submit:hover {
      background: #fd0404;
      transform: translateY(-2px);
    }
    
    .btn-submit:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .alert {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      display: none;
      text-align: center;
    }
    
    .alert-error {
      background: #ff4444;
      color: white;
    }
    
    .alert-success {
      background: #4CAF50;
      color: white;
    }
    
    .alert-warning {
      background: #ff9800;
      color: white;
    }
    
    footer {
      background: rgba(52, 113, 204, 0.3);
      backdrop-filter: blur(10px);
      padding: 1rem;
      text-align: center;
      margin-top: 3rem;
    }
    
    .guest-fields {
      background: rgba(255, 255, 255, 0.05);
      padding: 1.5rem;
      border-radius: 10px;
      margin-bottom: 1.5rem;
      border: 1px dashed rgba(255, 255, 255, 0.2);
    }
    
    .guest-fields h4 {
      color: #50c2f7;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }
  </style>
</head>
<body>

<nav>
  <div class="nav-left">
    <a href="index.html">← Back to Home</a>
  </div>
  <div class="nav-right">
    <a href="services.html">Services</a>
    <a href="client-dashboard.html" id="dashboardLink" style="display: none;">Dashboard</a>
    <a href="login.html" id="loginLink">Login</a>
  </div>
</nav>

<main>
  <div class="page-header">
    <h1>Request a Quote</h1>
    <p>Tell us about your project and we'll get back to you soon!</p>
  </div>

  <!-- User Status -->
  <div class="user-status" id="userStatus">
    <p id="statusText">✨ You can request a quote as a guest, or <a href="login.html" style="color: #50c2f7; font-weight: 600;">login</a> to track your quote status in real-time.</p>
  </div>

  <div class="form-container">
    <div id="serviceInfo" class="service-info" style="display: none;">
      <h3 id="serviceName">Service Name</h3>
      <p id="serviceDetails">Category • Base Price</p>
    </div>

    <div class="alert alert-error" id="errorMessage"></div>
    <div class="alert alert-success" id="successMessage"></div>

    <form id="quoteForm">
      <!-- Guest Contact Information (shown only if not logged in) -->
      <div id="guestFields" class="guest-fields">
        <h4>Your Contact Information</h4>
        
        <div class="form-group">
          <label for="guestName">Your Name <span class="required">*</span></label>
          <input 
            type="text" 
            id="guestName" 
            placeholder="John Doe" 
            required
          >
        </div>

        <div class="form-group">
          <label for="guestEmail">Your Email <span class="required">*</span></label>
          <input 
            type="email" 
            id="guestEmail" 
            placeholder="john@example.com" 
            required
          >
        </div>

        <div class="form-group">
          <label for="guestPhone">Phone Number (Optional)</label>
          <input 
            type="tel" 
            id="guestPhone" 
            placeholder="09171234567"
          >
        </div>
      </div>

      <!-- Service Selection -->
      <div class="form-group">
        <label for="service">Select Service <span class="required">*</span></label>
        <select id="service" required>
          <option value="">-- Choose a service --</option>
        </select>
      </div>

      <div class="form-group">
        <label for="projectName">Project Name <span class="required">*</span></label>
        <input 
          type="text" 
          id="projectName" 
          placeholder="e.g., My Business Logo Design" 
          required
        >
      </div>

      <div class="form-group">
        <label for="description">Project Description <span class="required">*</span></label>
        <textarea 
          id="description" 
          placeholder="Describe your project, goals, target audience, and any specific requirements..."
          required
        ></textarea>
      </div>

      <div class="form-group">
        <label for="budget">Budget Range <span class="required">*</span></label>
        <select id="budget" required>
          <option value="">-- Select budget --</option>
          <option value="₱1,000 - ₱3,000">₱1,000 - ₱3,000</option>
          <option value="₱3,000 - ₱5,000">₱3,000 - ₱5,000</option>
          <option value="₱5,000 - ₱10,000">₱5,000 - ₱10,000</option>
          <option value="₱10,000 - ₱20,000">₱10,000 - ₱20,000</option>
          <option value="₱20,000+">₱20,000+</option>
          <option value="Flexible">Flexible</option>
        </select>
      </div>

      <div class="form-group">
        <label for="deadline">Deadline <span class="required">*</span></label>
        <input 
          type="date" 
          id="deadline" 
          required
        >
      </div>

      <div class="form-group">
        <label for="additionalInfo">Additional Information (Optional)</label>
        <textarea 
          id="additionalInfo" 
          placeholder="Any other details, references, or special requests..."
        ></textarea>
      </div>

      <button type="submit" class="btn-submit" id="submitBtn">
        <span id="btnText">Submit Quote Request</span>
      </button>
    </form>
  </div>
</main>

<footer>
  <p>© 2025 Jefrey Jurado. All rights reserved.</p>
</footer>

<script>
  const API_URL = 'http://localhost:5000/api';
  
  // Check if user is logged in (OPTIONAL - not required)
  const token = localStorage.getItem('token');
  const user = JSON.parse(localStorage.getItem('user') || '{}');
  
  const isLoggedIn = !!token;
  
  // Update UI based on login status
  if (isLoggedIn) {
    document.getElementById('userStatus').classList.add('logged-in');
    document.getElementById('statusText').innerHTML = 
      `✅ Logged in as <strong>${user.name}</strong> - Your quote will be tracked in your dashboard.`;
    document.getElementById('guestFields').style.display = 'none';
    document.getElementById('dashboardLink').style.display = 'inline';
    document.getElementById('loginLink').textContent = 'Logout';
    document.getElementById('loginLink').href = '#';
    document.getElementById('loginLink').onclick = () => {
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      window.location.reload();
    };
  }
  
  // Get service ID from URL if provided
  const urlParams = new URLSearchParams(window.location.search);
  const preSelectedServiceId = urlParams.get('service');
  
  // Form elements
  const quoteForm = document.getElementById('quoteForm');
  const serviceSelect = document.getElementById('service');
  const submitBtn = document.getElementById('submitBtn');
  const btnText = document.getElementById('btnText');
  const errorMsg = document.getElementById('errorMessage');
  const successMsg = document.getElementById('successMessage');
  const serviceInfo = document.getElementById('serviceInfo');
  
  // Set minimum date to today
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('deadline').setAttribute('min', today);
  
  // Fetch and populate services
  async function loadServices() {
    try {
      const response = await fetch(`${API_URL}/services`);
      const data = await response.json();
      
      if (data.success && data.services.length > 0) {
        serviceSelect.innerHTML = '<option value="">-- Choose a service --</option>';
        
        data.services.forEach(service => {
          const option = document.createElement('option');
          option.value = service._id;
          option.textContent = `${service.name} - ₱${service.price.toLocaleString()}`;
          option.dataset.name = service.name;
          option.dataset.category = service.category;
          option.dataset.price = service.price;
          serviceSelect.appendChild(option);
        });
        
        // Pre-select service if provided in URL
        if (preSelectedServiceId) {
          serviceSelect.value = preSelectedServiceId;
          showServiceInfo();
        }
      }
    } catch (error) {
      console.error('Load services error:', error);
      errorMsg.textContent = 'Error loading services';
      errorMsg.style.display = 'block';
    }
  }
  
  // Show selected service info
  function showServiceInfo() {
    const selected = serviceSelect.options[serviceSelect.selectedIndex];
    if (selected.value) {
      document.getElementById('serviceName').textContent = selected.dataset.name;
      document.getElementById('serviceDetails').textContent = 
        `${selected.dataset.category} • Base Price: ₱${parseInt(selected.dataset.price).toLocaleString()}`;
      serviceInfo.style.display = 'block';
    } else {
      serviceInfo.style.display = 'none';
    }
  }
  
  serviceSelect.addEventListener('change', showServiceInfo);
  
  // Handle form submission
  quoteForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = {
      service: document.getElementById('service').value,
      projectName: document.getElementById('projectName').value.trim(),
      description: document.getElementById('description').value.trim(),
      budget: document.getElementById('budget').value,
      deadline: document.getElementById('deadline').value,
      additionalInfo: document.getElementById('additionalInfo').value.trim()
    };
    
    // Add guest contact info if not logged in
    if (!isLoggedIn) {
      formData.guestName = document.getElementById('guestName').value.trim();
      formData.guestEmail = document.getElementById('guestEmail').value.trim();
      formData.guestPhone = document.getElementById('guestPhone').value.trim();
      
      if (!formData.guestName || !formData.guestEmail) {
        errorMsg.textContent = 'Please provide your name and email';
        errorMsg.style.display = 'block';
        return;
      }
    }
    
    // Validation
    if (!formData.service || !formData.projectName || !formData.description || 
        !formData.budget || !formData.deadline) {
      errorMsg.textContent = 'Please fill in all required fields';
      errorMsg.style.display = 'block';
      return;
    }
    
    errorMsg.style.display = 'none';
    successMsg.style.display = 'none';
    
    btnText.textContent = 'Submitting...';
    submitBtn.disabled = true;
    
    try {
      const headers = { 'Content-Type': 'application/json' };
      if (isLoggedIn) {
        headers['Authorization'] = `Bearer ${token}`;
      }
      
      const response = await fetch(`${API_URL}/quotations`, {
        method: 'POST',
        headers: headers,
        body: JSON.stringify(formData)
      });
      
      const data = await response.json();
      
          if (data.success) {
      // Show success message
      if (isLoggedIn) {
        successMsg.innerHTML = '✅ Quote request submitted successfully!<br>View it in your <a href="client-dashboard.html" style="color: white; text-decoration: underline;">dashboard</a>.';
      } else {
        successMsg.innerHTML = '✅ Quote request submitted successfully!<br>We\'ll contact you at <strong>' + formData.guestEmail + '</strong> within 24 hours.<br><small>Want to track your quote? <a href="register.html" style="color: white; text-decoration: underline;">Create an account</a></small>';
      }
      successMsg.style.display = 'block';
      quoteForm.reset();
      serviceInfo.style.display = 'none';
      
      // Change button to green with "Submitted!" text
      btnText.textContent = '✅ Submitted!';
      submitBtn.style.background = '#4CAF50'; // Green color
      submitBtn.style.transform = 'scale(1.05)';
      submitBtn.disabled = true;
      
      // After 5 seconds, reset button to original state
      setTimeout(() => {
        btnText.textContent = 'Submit Quote Request';
        submitBtn.style.background = '#7e0101'; // Original red color
        submitBtn.style.transform = 'scale(1)';
        submitBtn.disabled = false;
      }, 5000); // 5 seconds
      
      // Redirect logged-in users to dashboard after 2 seconds
      if (isLoggedIn) {
        setTimeout(() => {
          window.location.href = 'client-dashboard.html';
        }, 2000);
      }
    }
      
      else {
        errorMsg.textContent = data.message || 'Failed to submit quote request';
        errorMsg.style.display = 'block';
        btnText.textContent = 'Submit Quote Request';
        submitBtn.disabled = false;
      }
      
    } catch (error) {
    console.error('Submit error:', error);
    errorMsg.textContent = '❌ Connection error. Please try again.';
    errorMsg.style.display = 'block';
    btnText.textContent = 'Submit Quote Request';
    submitBtn.disabled = false;
    }
  });
  
  // Load services on page load
  loadServices();
</script>
</body>
</html>