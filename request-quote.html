<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Request a Quote - Jefrey Jurado</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Open Sans', Arial, sans-serif;
      background: linear-gradient(135deg, #1C4D8C, #000);
      min-height: 100vh;
      color: #fff;
      display: flex;
      flex-direction: column;
    }
    
    nav {
      background: rgba(52, 113, 204, 0.3);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .nav-left a {
      color: #50c2f7;
      text-decoration: none;
      font-size: 1.2rem;
      font-weight: bold;
    }
    
    .nav-right a {
      color: #02f7ff;
      text-decoration: none;
      margin-left: 1rem;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      font-weight: 600;
    }
    
    main {
      flex: 1;
      padding: 3rem 2rem;
      max-width: 800px;
      margin: 0 auto;
      width: 100%;
    }
    
    .page-header {
      text-align: center;
      margin-bottom: 3rem;
    }
    
    .page-header h1 {
      color: #50c2f7;
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }
    
    .page-header p {
      color: #ddd;
      font-size: 1.1rem;
    }
    
    .form-container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 3rem;
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: #fff;
      font-weight: 600;
    }
    
    .form-group label .required {
      color: #ff4444;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 1rem;
      border: 1px solid #3471cc;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.9);
      font-size: 1rem;
      font-family: 'Open Sans', Arial, sans-serif;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #50c2f7;
      box-shadow: 0 0 0 3px rgba(80, 194, 247, 0.2);
      background: white;
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 120px;
    }
    
    .service-info {
      background: rgba(80, 194, 247, 0.1);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      border: 1px solid rgba(80, 194, 247, 0.3);
    }
    
    .service-info h3 {
      color: #50c2f7;
      margin-bottom: 0.5rem;
      font-size: 1.2rem;
    }
    
    .service-info p {
      color: #ddd;
      margin: 0;
    }
    
    .btn-submit {
      width: 100%;
      padding: 1rem;
      background: #7e0101;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-submit:hover {
      background: #fd0404;
      transform: translateY(-2px);
    }
    
    .btn-submit:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .alert {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      display: none;
      text-align: center;
    }
    
    .alert-error {
      background: #ff4444;
      color: white;
    }
    
    .alert-success {
      background: #4CAF50;
      color: white;
    }
    
    .alert-warning {
      background: #ff9800;
      color: white;
    }
    
    footer {
      background: rgba(52, 113, 204, 0.3);
      backdrop-filter: blur(10px);
      padding: 1rem;
      text-align: center;
      margin-top: 3rem;
    }
  </style>
</head>
<body>

<nav>
  <div class="nav-left">
    <a href="index.html">üé® Design Platform</a>
  </div>
  <div class="nav-right">
    <a href="services.html">Services</a>
    <a href="client-dashboard.html">Dashboard</a>
  </div>
</nav>

<main>
  <div class="page-header">
    <h1>Request a Quote</h1>
    <p>Tell us about your project and we'll get back to you soon!</p>
  </div>

  <div class="form-container">
    <div id="serviceInfo" class="service-info" style="display: none;">
      <h3 id="serviceName">Service Name</h3>
      <p id="serviceDetails">Category ‚Ä¢ Base Price</p>
    </div>

    <div class="alert alert-error" id="errorMessage"></div>
    <div class="alert alert-success" id="successMessage"></div>
    <div class="alert alert-warning" id="warningMessage"></div>

    <form id="quoteForm">
      <div class="form-group">
        <label for="service">Select Service <span class="required">*</span></label>
        <select id="service" required>
          <option value="">-- Choose a service --</option>
        </select>
      </div>

      <div class="form-group">
        <label for="projectName">Project Name <span class="required">*</span></label>
        <input 
          type="text" 
          id="projectName" 
          placeholder="e.g., My Business Logo Design" 
          required
        >
      </div>

      <div class="form-group">
        <label for="description">Project Description <span class="required">*</span></label>
        <textarea 
          id="description" 
          placeholder="Describe your project, goals, target audience, and any specific requirements..."
          required
        ></textarea>
      </div>

      <div class="form-group">
        <label for="budget">Budget Range <span class="required">*</span></label>
        <select id="budget" required>
          <option value="">-- Select budget --</option>
          <option value="‚Ç±1,000 - ‚Ç±3,000">‚Ç±1,000 - ‚Ç±3,000</option>
          <option value="‚Ç±3,000 - ‚Ç±5,000">‚Ç±3,000 - ‚Ç±5,000</option>
          <option value="‚Ç±5,000 - ‚Ç±10,000">‚Ç±5,000 - ‚Ç±10,000</option>
          <option value="‚Ç±10,000 - ‚Ç±20,000">‚Ç±10,000 - ‚Ç±20,000</option>
          <option value="‚Ç±20,000+">‚Ç±20,000+</option>
          <option value="Flexible">Flexible</option>
        </select>
      </div>

      <div class="form-group">
        <label for="deadline">Deadline <span class="required">*</span></label>
        <input 
          type="date" 
          id="deadline" 
          required
        >
      </div>

      <div class="form-group">
        <label for="additionalInfo">Additional Information (Optional)</label>
        <textarea 
          id="additionalInfo" 
          placeholder="Any other details, references, or special requests..."
        ></textarea>
      </div>

      <button type="submit" class="btn-submit" id="submitBtn">
        <span id="btnText">Submit Quote Request</span>
      </button>
    </form>
  </div>
</main>

<footer>
  <p>¬© 2026 Jefrey Jurado. All rights reserved.</p>
</footer>

<script>
  const API_URL = 'http://localhost:5000/api';
  
  // Check if user is logged in
  const token = localStorage.getItem('token');
  const user = JSON.parse(localStorage.getItem('user') || '{}');
  
  if (!token) {
    alert('Please login to request a quote');
    window.location.href = 'login.html';
  }
  
  // Get service ID from URL if provided
  const urlParams = new URLSearchParams(window.location.search);
  const preSelectedServiceId = urlParams.get('service');
  
  // Form elements
  const quoteForm = document.getElementById('quoteForm');
  const serviceSelect = document.getElementById('service');
  const submitBtn = document.getElementById('submitBtn');
  const btnText = document.getElementById('btnText');
  const errorMsg = document.getElementById('errorMessage');
  const successMsg = document.getElementById('successMessage');
  const warningMsg = document.getElementById('warningMessage');
  const serviceInfo = document.getElementById('serviceInfo');
  
  // Set minimum date to today
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('deadline').setAttribute('min', today);
  
  // Fetch and populate services
  async function loadServices() {
    try {
      const response = await fetch(`${API_URL}/services`);
      const data = await response.json();
      
      if (data.success && data.services.length > 0) {
        serviceSelect.innerHTML = '<option value="">-- Choose a service --</option>';
        
        data.services.forEach(service => {
          const option = document.createElement('option');
          option.value = service._id;
          option.textContent = `${service.name} - ‚Ç±${service.price.toLocaleString()}`;
          option.dataset.name = service.name;
          option.dataset.category = service.category;
          option.dataset.price = service.price;
          serviceSelect.appendChild(option);
        });
        
        // Pre-select service if provided in URL
        if (preSelectedServiceId) {
          serviceSelect.value = preSelectedServiceId;
          showServiceInfo();
        }
      } else {
        warningMsg.textContent = 'No services available at the moment.';
        warningMsg.style.display = 'block';
      }
    } catch (error) {
      console.error('Load services error:', error);
      errorMsg.textContent = 'Error loading services';
      errorMsg.style.display = 'block';
    }
  }
  
  // Show selected service info
  function showServiceInfo() {
    const selected = serviceSelect.options[serviceSelect.selectedIndex];
    if (selected.value) {
      document.getElementById('serviceName').textContent = selected.dataset.name;
      document.getElementById('serviceDetails').textContent = 
        `${selected.dataset.category} ‚Ä¢ Base Price: ‚Ç±${parseInt(selected.dataset.price).toLocaleString()}`;
      serviceInfo.style.display = 'block';
    } else {
      serviceInfo.style.display = 'none';
    }
  }
  
  serviceSelect.addEventListener('change', showServiceInfo);
  
  // Handle form submission
  quoteForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = {
      service: document.getElementById('service').value,
      projectName: document.getElementById('projectName').value.trim(),
      description: document.getElementById('description').value.trim(),
      budget: document.getElementById('budget').value,
      deadline: document.getElementById('deadline').value,
      additionalInfo: document.getElementById('additionalInfo').value.trim()
    };
    
    // Validation
    if (!formData.service || !formData.projectName || !formData.description || 
        !formData.budget || !formData.deadline) {
      errorMsg.textContent = 'Please fill in all required fields';
      errorMsg.style.display = 'block';
      return;
    }
    
    errorMsg.style.display = 'none';
    successMsg.style.display = 'none';
    
    btnText.textContent = 'Submitting...';
    submitBtn.disabled = true;
    
    try {
      const response = await fetch(`${API_URL}/quotations`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(formData)
      });
      
      const data = await response.json();
      
      if (data.success) {
        successMsg.textContent = '‚úÖ Quote request submitted successfully! We\'ll get back to you soon.';
        successMsg.style.display = 'block';
        quoteForm.reset();
        serviceInfo.style.display = 'none';
        
        setTimeout(() => {
          window.location.href = 'client-dashboard.html';
        }, 2000);
      } else {
        errorMsg.textContent = data.message || 'Failed to submit quote request';
        errorMsg.style.display = 'block';
        btnText.textContent = 'Submit Quote Request';
        submitBtn.disabled = false;
      }
    } catch (error) {
      console.error('Submit error:', error);
      errorMsg.textContent = '‚ùå Connection error. Make sure you\'re logged in.';
      errorMsg.style.display = 'block';
      btnText.textContent = 'Submit Quote Request';
      submitBtn.disabled = false;
    }
  });
  
  // Load services on page load
  loadServices();
</script>
</body>
</html>